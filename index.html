<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Trabalhista</title>
    <!-- Carrega Tailwind CSS para estilização moderna e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* Configurações de tema e fonte (DARK MODE) */
        :root {
            --color-primary: #60a5fa; /* Azul claro do Tailwind 'blue-400' */
            --color-secondary: #1a1a1a; /* Fundo escuro */
            --color-success: #10b981; /* Verde */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-secondary); /* Usa o novo fundo escuro */
        }
        .card {
            background-color: #2d2d2d; /* Fundo do card escuro */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.2); /* Sombra mais visível */
        }
        .tooltip-container {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }
        .tooltip-text {
            visibility: hidden;
            width: 300px;
            background-color: #555; /* Fundo mais escuro para tooltip */
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 10;
            bottom: 125%; /* Posição acima do elemento pai */
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }
        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        /* Responsividade para o container principal */
        @media (min-width: 1024px) {
            .main-grid {
                grid-template-columns: 1.5fr 1fr;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="mb-8 text-center">
        <h1 class="text-4xl font-extrabold text-gray-100 tracking-tight">Calculadora Trabalhista - GTK</h1>
        <p class="text-gray-400 mt-2">Cálculo de INSS e IRRF conforme tabelas progressivas</p>
    </header>

    <main class="max-w-6xl mx-auto grid grid-cols-1 lg:main-grid gap-8">
        
        <!-- Card de Entradas -->
        <div id="input-card" class="card p-6 md:p-8">
            <h2 class="text-2xl font-semibold mb-6 text-gray-100 border-b border-gray-600 pb-3">Entradas do Salário Bruto e Deduções</h2>
            
            <form id="calculation-form" class="space-y-5">

                <!-- Grupo de Entradas Brutas -->
                <div class="grid sm:grid-cols-2 gap-5">
                    
                    <!-- CAMPOS PARA CÁLCULO DSR (MOVIMENTADOS PARA O TOPO) -->
                    <label class="block">
                        <span class="text-gray-200 font-medium">Dias Úteis do Mês</span>
                        <input type="number" id="diasUteis" class="mt-1 block w-full rounded-md border-gray-600 shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-400 focus:ring-opacity-50 p-2 border bg-gray-700 text-white" value="22" min="1" step="1">
                    </label>
                    <label class="block">
                        <span class="text-gray-200 font-medium">Dias de DSR (Descanso Remunerado)</span>
                        <input type="number" id="dsr" class="mt-1 block w-full rounded-md border-gray-600 shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-400 focus:ring-opacity-50 p-2 border bg-gray-700 text-white" value="5" min="0" step="1">
                    </label>

                    <label class="block">
                        <span class="text-gray-200 font-medium">Salário Base (R$)</span>
                        <input type="number" id="salarioBase" class="mt-1 block w-full rounded-md border-gray-600 shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-400 focus:ring-opacity-50 p-2 border bg-gray-700 text-white" value="0.00" min="0" step="0.01">
                    </label>
                    <label class="block">
                        <span class="text-gray-200 font-medium">Comissão (R$)</span>
                        <input type="number" id="comissao" class="mt-1 block w-full rounded-md border-gray-600 shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-400 focus:ring-opacity-50 p-2 border bg-gray-700 text-white" value="0.00" min="0" step="0.01">
                    </label>
                    
                    <label class="block">
                        <span class="text-gray-200 font-medium">Prêmio (R$)</span>
                        <input type="number" id="premio" class="mt-1 block w-full rounded-md border-gray-600 shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-400 focus:ring-opacity-50 p-2 border bg-gray-700 text-white" value="0.00" min="0" step="0.01">
                    </label>
                    <!-- NOVO CAMPO: Horas Extras -->
                    <label class="block">
                        <span class="text-gray-200 font-medium">Horas Extras (R$)</span>
                        <input type="number" id="horasExtras" class="mt-1 block w-full rounded-md border-gray-600 shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-400 focus:ring-opacity-50 p-2 border bg-gray-700 text-white" value="0.00" min="0" step="0.01">
                    </label>
                </div>

                <!-- NOTAS SOBRE INCIDÊNCIA DE IMPOSTOS -->
                <p class="text-xs text-gray-400 -mt-3">
                    Nota: Prêmios **não** geram incidências de INSS ou FGTS. Horas Extras **sim**, e ainda geram reflexo de DSR.
                </p>

                <!-- DISPLAY DOS REFLEXOS CALCULADOS (2 COLUNAS) -->
                <div class="grid sm:grid-cols-2 gap-5 pt-3">
                    <!-- Reflexo de Comissão -->
                    <div class="flex justify-between items-center py-2 px-3 bg-indigo-900 rounded-md border border-indigo-700">
                        <span class="text-gray-200 font-medium">Reflexo de Comissão (R$)</span>
                        <span id="reflexoComissaoDisplay" class="font-bold text-indigo-400">R$ 0,00</span>
                    </div>
                    <!-- NOVO REFLEXO: Horas Extras -->
                    <div class="flex justify-between items-center py-2 px-3 bg-indigo-900 rounded-md border border-indigo-700">
                        <span class="text-gray-200 font-medium">Reflexo de Horas Extras (R$)</span>
                        <span id="reflexoHorasExtrasDisplay" class="font-bold text-indigo-400">R$ 0,00</span>
                    </div>
                </div>
                
                <!-- Grupo de Deduções -->
                <h3 class="text-xl font-semibold pt-4 border-t border-gray-600 mt-4 text-gray-100">Deduções e Dependentes</h3>

                <label class="block">
                    <span class="text-gray-200 font-medium">Número de Dependentes</span>
                    <input type="number" id="dependentes" class="mt-1 block w-full rounded-md border-gray-600 shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-400 focus:ring-opacity-50 p-2 border bg-gray-700 text-white" value="0" min="0" step="1">
                </label>

                <!-- Campos de Plano de Saúde e Outros Descontos (Layout 1x1) -->
                <div class="grid sm:grid-cols-2 gap-5">
                    <label class="block">
                        <span class="text-gray-200 font-medium">Mensalidade Plano Saúde (R$)</span>
                        <input type="number" id="planoSaude" class="mt-1 block w-full rounded-md border-gray-600 shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-400 focus:ring-opacity-50 p-2 border bg-gray-700 text-white" value="0.00" min="0" step="0.01">
                    </label>
                    <label class="block">
                        <span class="text-gray-200 font-medium">Outros Descontos (R$)</span>
                        <input type="number" id="outrosDescontos" class="mt-1 block w-full rounded-md border-gray-600 shadow-sm focus:border-blue-400 focus:ring focus:ring-blue-400 focus:ring-opacity-50 p-2 border bg-gray-700 text-white" value="0.00" min="0" step="0.01">
                    </label>
                </div>
                <!-- Fim dos Campos de Descontos -->

                <div class="pt-2 bg-blue-900 p-3 rounded-lg border border-blue-700">
                    <p class="text-sm font-medium text-blue-300">
                        O sistema aplica automaticamente a forma de dedução mais benéfica ao contribuinte no cálculo do IRRF, comparando a Dedução Legal Completa (INSS + Dependentes) com a Dedução Simplificada (R$ 607,20).
                    </p>
                </div>

                <!-- Botões -->
                <div class="flex space-x-4 pt-4">
                    <button type="button" onclick="calcularTudo()" class="flex-1 px-4 py-3 bg-blue-500 text-white font-bold rounded-lg shadow-md hover:bg-blue-600 transition duration-150 transform hover:scale-[1.02]">
                        Calcular
                    </button>
                    <button type="button" onclick="limparCampos()" class="flex-1 px-4 py-3 bg-gray-600 text-white font-bold rounded-lg shadow-md hover:bg-gray-700 transition duration-150 transform hover:scale-[1.02]">
                        Limpar
                    </button>
                </div>

            </form>
        </div>

        <!-- Card de Resultados -->
        <div id="output-card" class="card p-6 md:p-8 h-fit lg:sticky lg:top-8">
            <h2 class="text-2xl font-semibold mb-6 text-gray-100 border-b border-gray-600 pb-3">Resultados dos Cálculos</h2>

            <div class="space-y-4">
                
                <!-- Linhas de Resultado Calculado -->
                <div class="flex justify-between items-center border-b border-gray-700 pb-2">
                    <span class="text-gray-400">Total Bruto</span>
                    <span id="resultadoTotalBruto" class="font-bold text-lg text-gray-200">R$ 0,00</span>
                </div>

                <!-- Base INSS -->
                <div class="flex justify-between items-center border-b border-gray-700 pb-2 tooltip-container">
                    <span class="text-gray-400">Base de Cálculo INSS</span>
                    <span class="tooltip-text">Base INSS = Mínimo entre o Salário de Contribuição (Salário + Comissão + Reflexos + Extras) e o Teto do INSS (R$ 8.157,41).</span>
                    <span id="resultadoBaseINSS" class="font-bold text-gray-200">R$ 0,00</span>
                </div>

                <!-- Base FGTS -->
                <div class="flex justify-between items-center border-b border-gray-700 pb-2 tooltip-container">
                    <span class="text-gray-400">Base de Cálculo FGTS</span>
                    <span class="tooltip-text">A base do FGTS é o Salário de Contribuição integral (excluindo apenas Prêmios).</span>
                    <span id="resultadoBaseFGTS" class="font-bold text-gray-200">R$ 0,00</span>
                </div>

                <!-- Valor FGTS -->
                <div class="flex justify-between items-center py-2 bg-green-900 rounded-lg px-2">
                    <span class="font-semibold text-green-400">FGTS Pago (8% Empresa)</span>
                    <span id="resultadoValorFGTS" class="font-extrabold text-xl text-green-400">R$ 0,00</span>
                </div>
                
                <!-- Desconto INSS -->
                <div class="flex justify-between items-center py-2 bg-gray-800 rounded-lg px-2 mt-4">
                    <span class="font-semibold text-gray-200">INSS Descontado</span>
                    <span id="resultadoINSS" class="font-extrabold text-xl text-red-400">R$ 0,00</span>
                </div>

                <!-- Base IRRF -->
                <div class="flex justify-between items-center border-b border-gray-700 pb-2 pt-2 tooltip-container">
                    <span class="text-gray-400">Base de Cálculo IRRF</span>
                    <span class="tooltip-text">
                        Base IRRF = Total Bruto (incluindo prêmio) - Dedução Total Aplicada. A Dedução Total Aplicada é o maior valor entre a Dedução Legal (INSS + Dependentes) e a Dedução Simplificada (R$ 607,20).
                    </span>
                    <span id="resultadoBaseIRRF" class="font-bold text-gray-200">R$ 0,00</span>
                </div>
                
                <!-- Dedução IRRF Aplicada (NOVA LINHA) -->
                <div class="flex justify-between items-center border-b border-gray-700 pb-2">
                    <span class="text-gray-400">Dedução IRRF Aplicada</span>
                    <span id="deducaoAplicadaTipo" class="font-bold text-gray-200">Legal (INSS + Dependentes)</span>
                </div>

                <!-- Desconto IRRF -->
                <div class="flex justify-between items-center py-2 bg-gray-800 rounded-lg px-2">
                    <span class="font-semibold text-gray-200">IRRF Descontado</span>
                    <span id="resultadoIRRF" class="font-extrabold text-xl text-red-400">R$ 0,00</span>
                </div>

                <!-- Desconto Plano de Saúde -->
                <div class="flex justify-between items-center border-b border-gray-700 pb-2">
                    <span class="text-gray-400">Desconto Plano de Saúde</span>
                    <span id="resultadoPlanoSaude" class="font-bold text-red-400">R$ 0,00</span>
                </div>
                
                <!-- Outros Descontos -->
                <div class="flex justify-between items-center border-b border-gray-700 pb-2">
                    <span class="text-gray-400">Outros Descontos</span>
                    <span id="resultadoOutrosDescontos" class="font-bold text-red-400">R$ 0,00</span>
                </div>

                <!-- Total de Descontos -->
                <div class="flex justify-between items-center border-t border-gray-600 pt-4">
                    <span class="text-xl font-bold text-gray-200">Total de Descontos</span>
                    <span id="resultadoTotalDescontos" class="font-extrabold text-2xl text-red-500">R$ 0,00</span>
                </div>

                <!-- Salário Líquido -->
                <div class="flex justify-between items-center pt-2">
                    <span class="text-2xl font-bold text-gray-100">Salário Líquido</span>
                    <span id="resultadoSalarioLiquido" class="font-extrabold text-3xl text-green-400">R$ 0,00</span>
                </div>

            </div>
        </div>
    </main>

    <script>
        // Variáveis de escopo global para o formulário e resultados
        const $ = id => document.getElementById(id);

        // --- Variáveis Globais e Tabelas ---

        // Tabela Progressiva INSS
        const INSS_TABLE = [
            { start: 0.00, end: 1518.00, rate: 0.075 },
            { start: 1518.01, end: 2793.88, rate: 0.09 },
            { start: 2793.89, end: 4190.83, rate: 0.12 },
            { start: 4190.84, end: 8157.41, rate: 0.14 }
        ];
        const INSS_MAX_CONTRIBUTION_BASE = 8157.41;

        // Tabela Progressiva IRRF
        const IRRF_TABLE = [
            { start: 0.00, end: 2428.80, rate: 0.00, deduction: 0.00 },
            { start: 2428.81, end: 2826.65, rate: 0.075, deduction: 182.16 },
            { start: 2826.66, end: 3751.05, rate: 0.15, deduction: 394.16 },
            { start: 3751.06, end: 4664.68, rate: 0.225, deduction: 675.49 },
            { start: 4664.69, end: Infinity, rate: 0.275, deduction: 908.73 }
        ];

        // Dedução por dependente (valor padrão de mercado)
        const DEPENDENT_DEDUCTION = 189.59;
        // Dedução simplificada mensal (valor fornecido pelo usuário)
        const SIMPLIFIED_DEDUCTION = 607.20;
        
        // Alíquota do FGTS (8% sobre a base de cálculo)
        const FGTS_RATE = 0.08; 

        /**
         * Formata um número como moeda brasileira (R$).
         * @param {number} value - O valor a ser formatado.
         * @returns {string} O valor formatado em Reais.
         */
        function formatCurrency(value) {
            // Arredonda para duas casas decimais para cálculos financeiros
            const roundedValue = Math.round(value * 100) / 100; 
            if (isNaN(roundedValue)) return "R$ 0,00";
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(roundedValue);
        }

        // --- Funções de Cálculo ---

        /**
         * Calcula o desconto do INSS usando a tabela progressiva (cálculo por faixas).
         * @param {number} base - A base de cálculo (Total Bruto limitado ao teto).
         * @returns {number} O valor do desconto de INSS.
         */
        function calcularINSS(base) {
            let baseCalculo = Math.min(base, INSS_MAX_CONTRIBUTION_BASE);
            if (baseCalculo <= 0) return 0;
            
            let accumulatedDesconto = 0;
            let previousLimit = 0;

            // Percorre as faixas para calcular o desconto progressivamente
            for (const faixa of INSS_TABLE) {
                const limit = faixa.end;
                const rate = faixa.rate;

                if (baseCalculo > previousLimit) {
                    // Quanto da base cabe nesta faixa
                    const valorNestaFaixa = Math.min(baseCalculo, limit) - previousLimit;
                    // O desconto nesta faixa é o valor contribuível vezes a alíquota
                    accumulatedDesconto += valorNestaFaixa * rate;
                }
                
                previousLimit = limit;
                // Se a base já estiver dentro ou abaixo do limite da faixa, interrompe
                if (baseCalculo <= limit) break;
            }

            // Arredonda o resultado final do INSS
            return Math.max(0, Math.round(accumulatedDesconto * 100) / 100);
        }
        
        /**
         * Calcula o desconto do IRRF usando a tabela progressiva e a parcela a deduzir.
         * @param {number} base - A base de cálculo IRRF.
         * @returns {number} O valor do desconto de IRRF.
         */
        function calcularIRRF(base) {
            if (base <= 0) return 0;

            let desconto = 0;

            // Encontra a faixa na tabela
            for (const faixa of IRRF_TABLE) {
                if (base >= faixa.start) {
                    if (base <= faixa.end || faixa.end === Infinity) {
                        // Aplica a alíquota e subtrai a parcela a deduzir (valor fixo por faixa)
                        desconto = (base * faixa.rate) - faixa.deduction;
                        break;
                    }
                }
            }

            // O desconto IRRF nunca pode ser negativo e deve ser arredondado
            return Math.max(0, Math.round(desconto * 100) / 100);
        }
        
        /**
         * Função principal que lê as entradas, executa os cálculos e atualiza a interface.
         */
        function calcularTudo() {
            // 1. Coleta e sanitiza as entradas
            const salarioBase = parseFloat($('salarioBase').value) || 0;
            const comissao = parseFloat($('comissao').value) || 0;
            const premio = parseFloat($('premio').value) || 0;
            // NOVO CAMPO: Horas Extras
            const horasExtras = parseFloat($('horasExtras').value) || 0; 
            
            const numDependentes = parseInt($('dependentes').value) || 0;
            const planoSaude = parseFloat($('planoSaude').value) || 0; 
            const outrosDescontos = parseFloat($('outrosDescontos').value) || 0; 

            // ENTRADAS PARA CÁLCULO DO REFLEXO
            const diasUteis = parseInt($('diasUteis').value) || 0;
            const dsr = parseInt($('dsr').value) || 0;

            // CÁLCULO DO REFLEXO DE COMISSÃO
            let reflexoComissao = 0;
            if (diasUteis > 0 && comissao > 0) {
                // Formula: (Comissão / Dias Úteis) * DSR
                reflexoComissao = (comissao / diasUteis) * dsr;
            }
            reflexoComissao = Math.round(reflexoComissao * 100) / 100;
            
            // CÁLCULO DO REFLEXO DE HORAS EXTRAS (NOVO)
            let reflexoHorasExtras = 0;
            if (diasUteis > 0 && horasExtras > 0) {
                // Formula: (Horas Extras / Dias Úteis) * DSR
                reflexoHorasExtras = (horasExtras / diasUteis) * dsr;
            }
            reflexoHorasExtras = Math.round(reflexoHorasExtras * 100) / 100;

            
            // 2. Cálculo do Total Bruto (Inclui Salário Base, Comissão, Reflexo, Prêmio, Horas Extras e Reflexo HE)
            const totalBruto = salarioBase + comissao + reflexoComissao + premio + horasExtras + reflexoHorasExtras;
            
            // 2b. Base Contribuível para INSS e FGTS (EXCLUI PRÊMIO)
            const baseContribuivel = salarioBase + comissao + reflexoComissao + horasExtras + reflexoHorasExtras;

            // 3. Cálculo do INSS
            const baseINSS = Math.min(baseContribuivel, INSS_MAX_CONTRIBUTION_BASE);
            const descontoINSS = calcularINSS(baseINSS);
            
            // 3b. Cálculo do FGTS (Base e Valor)
            const baseFGTS = baseContribuivel; // FGTS não tem teto, é sobre a base integral
            const valorFGTS = baseFGTS * FGTS_RATE;

            // 4. Cálculo da Base de IRRF (Utiliza o Total Bruto)
            let deducaoTipo = '';
            
            // 4a. Dedução Legal Completa (INSS + Dependentes)
            const deducaoDependentes = numDependentes * DEPENDENT_DEDUCTION;
            const deducaoLegalCompleta = descontoINSS + deducaoDependentes; 

            // 4b. Dedução Simplificada Fixa
            const deducaoSimplificadaFixa = SIMPLIFIED_DEDUCTION;
            
            // 4c. Escolhe a dedução total mais vantajosa
            let totalDeducoesIRRF = 0;
            
            if (deducaoSimplificadaFixa > deducaoLegalCompleta) {
                 totalDeducoesIRRF = deducaoSimplificadaFixa;
                 deducaoTipo = 'Simplificada (R$ ' + SIMPLIFIED_DEDUCTION.toFixed(2).replace('.', ',') + ')';
            } else {
                 totalDeducoesIRRF = deducaoLegalCompleta;
                 deducaoTipo = 'Legal (INSS + Dependentes)';
            }
            
            // 4d. Base IRRF = Total Bruto - Dedução Total Aplicada.
            const baseIRRF = Math.max(0, totalBruto - totalDeducoesIRRF);
            
            // 5. Cálculo do IRRF
            const descontoIRRF = calcularIRRF(baseIRRF);

            // 6. Resultados Finais
            // TOTAL DE DESCONTOS: INSS + IRRF + Plano de Saúde + Outros Descontos
            const totalDescontos = descontoINSS + descontoIRRF + planoSaude + outrosDescontos; 
            const salarioLiquido = totalBruto - totalDescontos;

            // 7. Atualiza a interface
            $('resultadoTotalBruto').textContent = formatCurrency(totalBruto);
            $('reflexoComissaoDisplay').textContent = formatCurrency(reflexoComissao); 
            $('reflexoHorasExtrasDisplay').textContent = formatCurrency(reflexoHorasExtras); // NOVO
            
            // Resultados INSS e FGTS
            $('resultadoBaseINSS').textContent = formatCurrency(baseINSS);
            $('resultadoINSS').textContent = formatCurrency(descontoINSS);
            $('resultadoBaseFGTS').textContent = formatCurrency(baseFGTS); 
            $('resultadoValorFGTS').textContent = formatCurrency(valorFGTS); 

            // Resultados IRRF e Líquido
            $('resultadoBaseIRRF').textContent = formatCurrency(baseIRRF);
            $('deducaoAplicadaTipo').textContent = deducaoTipo;
            $('resultadoIRRF').textContent = formatCurrency(descontoIRRF);
            $('resultadoPlanoSaude').textContent = formatCurrency(planoSaude); 
            $('resultadoOutrosDescontos').textContent = formatCurrency(outrosDescontos); 
            $('resultadoTotalDescontos').textContent = formatCurrency(totalDescontos);
            $('resultadoSalarioLiquido').textContent = formatCurrency(salarioLiquido);
        }

        /**
         * Limpa todos os campos do formulário e redefine os resultados.
         */
        function limparCampos() {
            const form = $('calculation-form');
            form.querySelectorAll('input[type="number"]').forEach(input => {
                if (input.id === 'dependentes' || input.id === 'dsr') {
                    input.value = '0';
                } else if (input.id === 'diasUteis') {
                    input.value = '22'; // Valor padrão razoável
                } else {
                    input.value = '0.00';
                }
            });
            
            // Executa o cálculo para limpar o display de resultados
            calcularTudo();
        }

        // --- Configuração de Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            const form = $('calculation-form');
            const inputs = form.querySelectorAll('input');

            // Adiciona listener para recalcular em qualquer alteração nos campos
            inputs.forEach(input => {
                input.addEventListener('input', calcularTudo);
            });

            // Executa o cálculo inicial
            calcularTudo();
        });
        
        // Inicializa o tooltip e a responsividade
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                'primary-blue': '#3b82f6',
                'success-green': '#10b981',
              },
              fontFamily: {
                sans: ['Inter', 'sans-serif'],
              },
            }
          }
        }
        
    </script>
</body>
</html>
